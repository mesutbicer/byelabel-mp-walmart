{
  "info": {
    "_postman_id": "walmart-service-collection",
    "name": "Walmart Service API",
    "description": "Walmart Marketplace API Integration Service - NestJS\n\n## Kullanım\n\n1. Environment'ı import edin veya oluşturun\n2. Variables'ı kendi değerlerinizle güncelleyin\n3. İstekleri sırayla test edin\n\n## Değişkenler\n\n- `baseUrl`: API base URL (default: http://localhost:8082)\n- `accountId`: ByeLabel hesap ID'niz\n- `storeId`: ByeLabel mağaza ID'niz\n- `clientId`: Walmart Client ID\n- `clientSecret`: Walmart Client Secret",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8082",
      "type": "string"
    },
    {
      "key": "accountId",
      "value": "test-account-123",
      "type": "string"
    },
    {
      "key": "storeId",
      "value": "test-store-456",
      "type": "string"
    },
    {
      "key": "clientId",
      "value": "your-walmart-client-id",
      "type": "string"
    },
    {
      "key": "clientSecret",
      "value": "your-walmart-client-secret",
      "type": "string"
    },
    {
      "key": "purchaseOrderId",
      "value": "1234567890123",
      "type": "string"
    },
    {
      "key": "lastUpdateDate",
      "value": "0",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Health",
      "description": "Servis sağlık kontrolleri",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health-check",
              "host": ["{{baseUrl}}"],
              "path": ["health-check"]
            },
            "description": "Servisin çalışır durumda olup olmadığını kontrol eder.\n\n**Beklenen Yanıt**: 200 OK"
          },
          "response": [
            {
              "name": "Success",
              "originalRequest": {
                "method": "GET",
                "url": "{{baseUrl}}/health-check"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "text"
            }
          ]
        },
        {
          "name": "Log Test",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/log-test",
              "host": ["{{baseUrl}}"],
              "path": ["log-test"]
            },
            "description": "Loglama sistemini test eder. Logstash bağlantısını doğrulamak için kullanılır."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Auth",
      "description": "Kullanıcı hesap yönetimi işlemleri",
      "item": [
        {
          "name": "Create or Update Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('Id');",
                  "    pm.expect(jsonData).to.have.property('UserId');",
                  "    pm.expect(jsonData).to.have.property('StoreId');",
                  "    pm.expect(jsonData.IsDeleted).to.eql(false);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"accountId\": \"{{accountId}}\",\n  \"storeId\": \"{{storeId}}\",\n  \"clientId\": \"{{clientId}}\",\n  \"clientSecret\": \"{{clientSecret}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Auth",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth"]
            },
            "description": "Yeni bir Walmart hesabı oluşturur veya mevcut hesabı günceller.\n\n**İşlem Akışı:**\n1. Client ID ve Client Secret ile Walmart API'ye bağlanılır\n2. Credentials doğrulanır (access token alınarak)\n3. Kullanıcı bilgileri veritabanında saklanır\n\n**Senaryolar:**\n- Yeni kullanıcı: Yeni kayıt oluşturulur\n- Aynı accountId ve storeId: Credentials güncellenir\n- Aynı accountId, farklı storeId: Store güncellenir\n- Farklı accountId, aynı clientId: Hata döner"
          },
          "response": [
            {
              "name": "Success - New User Created",
              "originalRequest": {
                "method": "POST",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"accountId\": \"test-account-123\",\n  \"storeId\": \"test-store-456\",\n  \"clientId\": \"your-client-id\",\n  \"clientSecret\": \"your-client-secret\"\n}"
                },
                "url": "{{baseUrl}}/api/Auth"
              },
              "status": "OK",
              "code": 200,
              "body": "{\n  \"Id\": 1,\n  \"UserId\": \"test-account-123\",\n  \"StoreId\": \"test-store-456\",\n  \"ClientId\": \"your-client-id\",\n  \"ClientSecret\": \"your-client-secret\",\n  \"IsDeleted\": false\n}",
              "_postman_previewlanguage": "json"
            },
            {
              "name": "Error - Invalid Credentials",
              "originalRequest": {
                "method": "POST",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"accountId\": \"test-account-123\",\n  \"storeId\": \"test-store-456\",\n  \"clientId\": \"invalid-client-id\",\n  \"clientSecret\": \"invalid-secret\"\n}"
                },
                "url": "{{baseUrl}}/api/Auth"
              },
              "status": "Bad Request",
              "code": 400,
              "body": "{\n  \"name\": \"BaseException\",\n  \"message\": \"Access Token not reacheable\"\n}",
              "_postman_previewlanguage": "json"
            },
            {
              "name": "Error - Store In Use",
              "originalRequest": {
                "method": "POST",
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"accountId\": \"different-account\",\n  \"storeId\": \"test-store-456\",\n  \"clientId\": \"existing-client-id\",\n  \"clientSecret\": \"your-secret\"\n}"
                },
                "url": "{{baseUrl}}/api/Auth"
              },
              "status": "Bad Request",
              "code": 400,
              "body": "{\n  \"name\": \"BaseException\",\n  \"message\": \"Walmart store is in use by another user.\"\n}",
              "_postman_previewlanguage": "json"
            }
          ]
        },
        {
          "name": "Delete Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Returns account ID', function () {",
                  "    var responseText = pm.response.text();",
                  "    pm.expect(responseText).to.include(pm.variables.get('accountId'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Auth/{{accountId}}/{{storeId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Auth", "{{accountId}}", "{{storeId}}"]
            },
            "description": "Belirtilen Walmart hesabını soft delete yapar.\n\n**NOT:** Bu işlem kullanıcıyı tamamen silmez, sadece IsDeleted flag'ini true yapar. Bu sayede geçmiş siparişler ve veriler korunur."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "\"test-account-123\"",
              "_postman_previewlanguage": "json"
            }
          ]
        }
      ]
    },
    {
      "name": "Order",
      "description": "Sipariş yönetimi işlemleri",
      "item": [
        {
          "name": "Get Orders After Date",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Son 30 günün timestamp'ini hesapla",
                  "if (!pm.variables.get('lastUpdateDate') || pm.variables.get('lastUpdateDate') === '0') {",
                  "    var thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);",
                  "    pm.variables.set('lastUpdateDate', thirtyDaysAgo.toString());",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "// İlk siparişin purchaseOrderId'sini kaydet (varsa)",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.length > 0 && jsonData[0].purchaseOrderId) {",
                  "    pm.collectionVariables.set('purchaseOrderId', jsonData[0].purchaseOrderId);",
                  "    console.log('Saved purchaseOrderId:', jsonData[0].purchaseOrderId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Order/GetOrdersAfterDate/{{accountId}}/{{storeId}}/{{lastUpdateDate}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Order", "GetOrdersAfterDate", "{{accountId}}", "{{storeId}}", "{{lastUpdateDate}}"]
            },
            "description": "Belirtilen tarihten sonra güncellenen tüm siparişleri döner.\n\n**İlk çağrıda**: Eğer kullanıcının hiç siparişi yoksa, Walmart API'den son 30 günün siparişleri otomatik olarak senkronize edilir.\n\n**lastUpdateDate parametresi**: Unix timestamp (milisaniye) formatında olmalıdır.\n\n**Sipariş Durumları**:\n- `awaiting`: Sipariş beklemede (Created, Acknowledged)\n- `shipped`: Sipariş kargoya verildi\n- `cancelled`: Sipariş iptal edildi"
          },
          "response": [
            {
              "name": "Success - Orders Found",
              "status": "OK",
              "code": 200,
              "body": "[\n  {\n    \"accountId\": \"test-account-123\",\n    \"purchaseOrderId\": \"1234567890123\",\n    \"customerOrderId\": \"C001234567\",\n    \"orderDate\": \"2024-01-15T10:30:00.000Z\",\n    \"shippingInfo\": {\n      \"phone\": \"5551234567\",\n      \"estimatedDeliveryDate\": 1705420800000,\n      \"methodCode\": \"Standard\",\n      \"postalAddress\": {\n        \"name\": \"John Doe\",\n        \"address1\": \"123 Main St\",\n        \"city\": \"New York\",\n        \"state\": \"NY\",\n        \"postalCode\": \"10001\",\n        \"country\": \"US\"\n      }\n    },\n    \"orderLines\": [\n      {\n        \"lineNumber\": \"1\",\n        \"item\": {\n          \"productName\": \"Widget A\",\n          \"sku\": \"WGT-001\"\n        },\n        \"quantity\": 2,\n        \"unitPrice\": 19.99,\n        \"totalPrice\": 39.98,\n        \"status\": \"Created\"\n      }\n    ],\n    \"totalAmount\": 39.98,\n    \"status\": \"awaiting\"\n  }\n]",
              "_postman_previewlanguage": "json"
            },
            {
              "name": "Success - No Orders",
              "status": "OK",
              "code": 200,
              "body": "[]",
              "_postman_previewlanguage": "json"
            },
            {
              "name": "Error - User Not Found",
              "status": "Bad Request",
              "code": 400,
              "body": "{\n  \"name\": \"UserNotFoundException\",\n  \"message\": \"User Not Found.\"\n}",
              "_postman_previewlanguage": "json"
            }
          ]
        },
        {
          "name": "Get Orders After Date (Alternative Route)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "if (!pm.variables.get('lastUpdateDate') || pm.variables.get('lastUpdateDate') === '0') {",
                  "    var thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);",
                  "    pm.variables.set('lastUpdateDate', thirtyDaysAgo.toString());",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Order/{{accountId}}/{{storeId}}/{{lastUpdateDate}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Order", "{{accountId}}", "{{storeId}}", "{{lastUpdateDate}}"]
            },
            "description": "GetOrdersAfterDate endpoint'inin alternatif route'u.\n\nAynı işlevi görür, farklı URL yapısı sunar."
          },
          "response": []
        },
        {
          "name": "Get Order By Purchase Order ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has order data', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('purchaseOrderId');",
                  "    pm.expect(jsonData).to.have.property('customerOrderId');",
                  "    pm.expect(jsonData).to.have.property('orderLines');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/Order/GetOrderFromApiByPurchaseOrderId/{{accountId}}/{{storeId}}/{{purchaseOrderId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Order", "GetOrderFromApiByPurchaseOrderId", "{{accountId}}", "{{storeId}}", "{{purchaseOrderId}}"]
            },
            "description": "Walmart API'den belirli bir siparişi çeker ve veritabanına kaydeder/günceller.\n\n**Kullanım Senaryosu:**\n- Belirli bir siparişin güncel durumunu almak istediğinizde\n- Sipariş detaylarını yenilemek istediğinizde\n\n**purchaseOrderId**: Walmart tarafından atanan benzersiz sipariş numarasıdır."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "body": "{\n  \"accountId\": \"test-account-123\",\n  \"purchaseOrderId\": \"1234567890123\",\n  \"customerOrderId\": \"C001234567\",\n  \"orderDate\": \"2024-01-15T10:30:00.000Z\",\n  \"shippingInfo\": {\n    \"phone\": \"5551234567\",\n    \"methodCode\": \"Standard\",\n    \"postalAddress\": {\n      \"name\": \"John Doe\",\n      \"address1\": \"123 Main St\",\n      \"city\": \"New York\",\n      \"state\": \"NY\",\n      \"postalCode\": \"10001\",\n      \"country\": \"US\"\n    }\n  },\n  \"orderLines\": [\n    {\n      \"lineNumber\": \"1\",\n      \"item\": {\n        \"productName\": \"Widget A\",\n        \"sku\": \"WGT-001\"\n      },\n      \"quantity\": 2,\n      \"unitPrice\": 19.99,\n      \"totalPrice\": 39.98,\n      \"status\": \"Created\"\n    }\n  ],\n  \"totalAmount\": 39.98,\n  \"status\": \"awaiting\"\n}",
              "_postman_previewlanguage": "json"
            },
            {
              "name": "Error - User Not Found",
              "status": "Bad Request",
              "code": 400,
              "body": "{\n  \"name\": \"UserNotFoundException\",\n  \"message\": \"User Not Found.\"\n}",
              "_postman_previewlanguage": "json"
            }
          ]
        },
        {
          "name": "Dispatch Order - Known Carrier",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Şu anki timestamp'i ayarla",
                  "pm.variables.set('shipDateTime', Date.now().toString());"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": \"{{purchaseOrderId}}\",\n  \"userId\": \"{{accountId}}\",\n  \"storeId\": \"{{storeId}}\",\n  \"shippingLines\": [\n    {\n      \"orderItemId\": \"1\",\n      \"orderItemQuantity\": 1,\n      \"shipDateTime\": {{shipDateTime}},\n      \"carrierName\": \"UPS\",\n      \"methodCode\": \"Standard\",\n      \"trackingNumber\": \"1Z999AA10123456784\",\n      \"trackingURL\": \"\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Order/DispatchOrder",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Order", "DispatchOrder"]
            },
            "description": "Siparişi Walmart'a kargoya verildi olarak bildirir.\n\n**Bu örnek bilinen bir kargo firması (UPS) ile gönderim yapar.**\n\n**Kural**: Bilinen kargo firması kullanıyorsanız `trackingNumber` zorunludur.\n\n**Desteklenen Kargo Firmaları**: UPS, USPS, FedEx, DHL, Airborne, OnTrac, LS, UDS, UPSMI, FDX, PILOT, ESTES, SAIA, Asendia, China Post, YunExpress, 4PX, Canada Post, Japan Post, Deutsche Post, SF Express ve daha fazlası..."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "text"
            },
            {
              "name": "Error - Missing Tracking Number",
              "status": "Bad Request",
              "code": 400,
              "body": "{\n  \"name\": \"BaseException\",\n  \"message\": \"Known Carrier Name - TrackingNumber or Unknown Carrier Name - Tracking Url pairs are required.\"\n}",
              "_postman_previewlanguage": "json"
            }
          ]
        },
        {
          "name": "Dispatch Order - Unknown Carrier",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "pm.variables.set('shipDateTime', Date.now().toString());"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": \"{{purchaseOrderId}}\",\n  \"userId\": \"{{accountId}}\",\n  \"storeId\": \"{{storeId}}\",\n  \"shippingLines\": [\n    {\n      \"orderItemId\": \"1\",\n      \"orderItemQuantity\": 1,\n      \"shipDateTime\": {{shipDateTime}},\n      \"carrierName\": \"MyLocalCarrier\",\n      \"methodCode\": \"Standard\",\n      \"trackingNumber\": \"\",\n      \"trackingURL\": \"https://mycarrier.com/track/ABC123\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/Order/DispatchOrder",
              "host": ["{{baseUrl}}"],
              "path": ["api", "Order", "DispatchOrder"]
            },
            "description": "Siparişi bilinmeyen bir kargo firması ile kargoya verildi olarak bildirir.\n\n**Bu örnek bilinmeyen bir kargo firması ile gönderim yapar.**\n\n**Kural**: Bilinmeyen kargo firması kullanıyorsanız `trackingURL` zorunludur."
          },
          "response": [
            {
              "name": "Success",
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "text"
            },
            {
              "name": "Error - Missing Tracking URL",
              "status": "Bad Request",
              "code": 400,
              "body": "{\n  \"name\": \"BaseException\",\n  \"message\": \"Known Carrier Name - TrackingNumber or Unknown Carrier Name - Tracking Url pairs are required.\"\n}",
              "_postman_previewlanguage": "json"
            }
          ]
        }
      ]
    },
    {
      "name": "Test Scenarios",
      "description": "Özel test senaryoları",
      "item": [
        {
          "name": "Full Flow - Create Account & Get Orders",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Bu istek sırayla çalıştırılacak koleksiyon runner için hazırlanmıştır",
                  "console.log('Starting full flow test...');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "item": [
            {
              "name": "Step 1 - Create Account",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"accountId\": \"{{accountId}}\",\n  \"storeId\": \"{{storeId}}\",\n  \"clientId\": \"{{clientId}}\",\n  \"clientSecret\": \"{{clientSecret}}\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/api/Auth",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "Auth"]
                }
              }
            },
            {
              "name": "Step 2 - Get Orders",
              "request": {
                "method": "GET",
                "url": {
                  "raw": "{{baseUrl}}/api/Order/GetOrdersAfterDate/{{accountId}}/{{storeId}}/0",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "Order", "GetOrdersAfterDate", "{{accountId}}", "{{storeId}}", "0"]
                }
              }
            },
            {
              "name": "Step 3 - Delete Account",
              "request": {
                "method": "DELETE",
                "url": {
                  "raw": "{{baseUrl}}/api/Auth/{{accountId}}/{{storeId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "Auth", "{{accountId}}", "{{storeId}}"]
                }
              }
            }
          ]
        }
      ]
    }
  ]
}
